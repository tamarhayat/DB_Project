-- select The names of all the products supplied by supplier 322864762 V
select ename
from (
select eid
from (select oID, eID from equip_order) 
natural join 
(select oid,sid from orders)
where sid= &<name="sid" hint="number with 9 digits" type= "integer" required= true>
) natural join Equipment


-- select all details by a choosen equipment.ename V

SELECT s.sID, s.sname, e.eID, e.ename, e.price
FROM Suppliers s
JOIN Orders o ON s.sID = o.sID
JOIN equip_order eo ON o.oID = eo.oID
JOIN Equipment e ON eo.eID = e.eID
WHERE e.ename = &<name="ename" hint="equipment name" type="string" required= true>;


-- update the quantity of equipment according to choosen order  V 

UPDATE Equipment e
SET e.quantity = e.quantity + (
  SELECT COALESCE(SUM(eo.amountInOrder), 0)
  FROM equip_order eo
  WHERE eo.eID = e.eID
  AND eo.oID = oID
)
WHERE e.eID IN (
  SELECT eo.eID
  FROM equip_order eo
  WHERE eo.oID =&<name="oID" hint="number with 5 digits" type="integer" required= true>
);

--select all necessary details about mobile or not mobile Equipment
select sid,sname,eid,ename,price 
from (Suppliers s natural join orders o) 
               natural join (equip_order eo natural join Equipment e) 
               where e.ismobile= &<name="mobility" 
               hint="show mobile or not mobile"
               list="true,false" type="string">;
               
-- Update the description for each repair of non-mobile equipment, adding "Note: This equipment is not mobile" to the description
UPDATE Repairs r
SET r.description = r.description || '. Note: This equipment is not mobile'
WHERE EXISTS (
    SELECT 1
    FROM EquipRepairs er
    JOIN Equipment e ON er.eID = e.eID
    WHERE er.rID = r.rID AND e.isMobile = 'false'
);

-- Select the names of all products and the latest supply date for each product

SELECT e.ename, TRUNC(MAX(o.orderDate)) AS last_supply_date
FROM Equipment e
JOIN equip_order eo ON e.eID = eo.eID
JOIN Orders o ON eo.oID = o.oID
GROUP BY e.ename
order by e.ename;



