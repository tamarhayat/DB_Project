
ALTER TABLE donors
ADD CONSTRAINT check_donor_phone
CHECK (phoneNumber LIKE '05_-_______');

ALTER TABLE equip_order
ADD CONSTRAINT check_amount_in_order
CHECK (amountInOrder > 0);

ALTER TABLE Equipment
ADD CONSTRAINT check_equipment_quantity
CHECK (quantity >= 0);

ALTER TABLE vehicle_equip
ADD CONSTRAINT check_equip_amount
CHECK (equipAmount >= 0);
commit;


--examples that show its work:
insert into DONORS (DID, DNAME, ADDRESS, PHONENUMBER)
values 
(222498461, 'Tori  Keaton', '27 Hong Kong, Lathrop, USA', '057-528143');

insert into EQUIP_ORDER (AMOUNTINORDER, EID, OID)
values (0, 10345, 40159);

insert into Equipment (eID, ename, isMobile, quantity, price) 
values (20403, 'Blood donation needle','false', -2, 150.45);

insert into vehicle_equip (EQUIPAMOUNT, EID, VID)
values (-1, 10323, 45140092);



----------------------------for delete query 1----------------------------

-- Drop the foreign key constraint
ALTER TABLE VehiclesRepairs
DROP CONSTRAINT SYS_C007714;
--add delete cascade
ALTER TABLE VehiclesRepairs
ADD CONSTRAINT fk_vehicles_repairs_vehicles
FOREIGN KEY (vID) REFERENCES Vehicles(vID) ON DELETE CASCADE;
commit;

--Drop the foreign key constraint
ALTER TABLE Vehicle_equip
DROP CONSTRAINT SYS_C007720;
--add delete cascade
ALTER TABLE vehicle_equip
ADD CONSTRAINT fk_vehicle_equip_vehicles
FOREIGN KEY (vID) REFERENCES Vehicles(vID) ON DELETE CASCADE;
commit;
---------------------------------------------------------------------------


----------------------------for delete query 2-----------------------------
ALTER TABLE orders
DROP CONSTRAINT fk_orders_suppliers;

---the deleting query----

ALTER TABLE orders
ADD CONSTRAINT fk_orders_suppliers
FOREIGN KEY (sID) REFERENCES suppliers(sid);
---------------------------------------------------------------------------
commit;

------------------add constraint for premium donor-------------------------

ALTER TABLE Donors ADD premium VARCHAR2(5) DEFAULT 'false' 
CHECK (premium IN ('true', 'false'));


UPDATE Donors SET premium = 'false';

commit;


---------add column for requiredb amount in vehicle-----------------------

ALTER TABLE equipment ADD required_in_vehicle integer DEFAULT 1 
CHECK (required_in_vehicle > 0 OR required_in_vehicle IS NULL);

update equipment set required_in_vehicle= null  where ismobile='false';
commit;

UPDATE equipment
    SET required_in_vehicle = TRUNC(DBMS_RANDOM.VALUE(2, 31))
    WHERE required_in_vehicle IS NOT NULL;
    

--------------------Stage 4------------------------------------------------
drop table COURSE_TOOL

ALTER TABLE Tool
DROP CONSTRAINT SYS_C008014;


ALTER TABLE Tool ADD eID NUMBER(5)
ALTER TABLE Tool RENAME COLUMN tool_name TO ename
ALTER TABLE Tool ADD isMobile VARCHAR2(5) DEFAULT 'false' 
ALTER TABLE Tool ADD quantity INT
ALTER TABLE Tool ADD required_in_vehicle NUMBER(5) DEFAULT NULL
ALTER TABLE Tool ADD price NUMBER(7,2)


ALTER TABLE Equipment MODIFY ename VARCHAR2(55); --increase to the big size
ALTER TABLE Equipment ADD weight FLOAT
ALTER TABLE Equipment ADD made_in VARCHAR2(50)
ALTER TABLE Equipment ADD color VARCHAR2(15)

---the relationship to tcategory
ALTER TABLE Equipment ADD category_name VARCHAR2(50)
ALTER TABLE Equipment add foreign key (CATEGORY_NAME) 
  references TCATEGORY (CATEGORY_NAME);



ALTER TABLE Tool MODIFY eID NOT NULL;
ALTER TABLE Tool MODIFY ename NOT NULL;
ALTER TABLE Tool MODIFY isMobile NOT NULL;
ALTER TABLE Tool MODIFY quantity NOT NULL;
ALTER TABLE Tool MODIFY price NOT NULL;
ALTER TABLE Equipment MODIFY made_in NOT NULL;
ALTER TABLE Equipment MODIFY color NOT NULL;
ALTER TABLE Equipment MODIFY weight NOT NULL;


ALTER TABLE tool
DROP CONSTRAINT SYS_C008015; --delete the connect to tcategory
drop table tool;  --delete the table

--crate the relationship table instead of the "course_tool" we delete

CREATE TABLE course_equip
(
  eID NUMBER(5),
  course_id NUMBER(5),
  PRIMARY KEY (eID, course_id),
  FOREIGN KEY (eID) REFERENCES Equipment(eID),
  FOREIGN KEY (course_id) REFERENCES Course(course_id)
);



